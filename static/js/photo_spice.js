// Generated by CoffeeScript 1.3.3
(function() {

  define(function(require) {
    var $, Modernizr, ResizeFu, checkScroll, em, exports, makeItHappen, makeMinHeight, moduleName, psVars, _window;
    $ = require("jquery");
    Modernizr = require("Modernizr");
    ResizeFu = require("resize_fu");
    exports = {};
    psVars = {
      fade: {
        low: 0.15,
        high: 0.75
      },
      fadebarID: "ps_fadebar",
      fadebar: "#ps_fadebar",
      h2: {
        ml1: -550,
        ml2: 410
      },
      sectionMargin: {
        top: 0,
        bottom: 0
      },
      peekNext: 3
    };
    moduleName = "photo_spice";
    em = parseInt($("body").css("font-size"), 10);
    _window = $(window);
    checkScroll = function(_this) {
      var gRange, getRGB, inverseOp, offset, opacity, pc, place, range, rgb, _h2;
      offset = _this.offset();
      place = Math.round(_this.height() + offset.top - _window.scrollTop());
      if (place > 0) {
        pc = (_window.height() - offset.top + _window.scrollTop()) / _window.height();
        _h2 = _this.find("h2");
        if (pc <= psVars.fade.low) {
          $(psVars.fadebar).css("opacity", 1);
          return _h2.css({
            "opacity": 0,
            "color": "#000"
          });
        } else if (pc < psVars.fade.high) {
          opacity = Math.round(100 * (1 - ((pc - psVars.fade.low) / (psVars.fade.high - psVars.fade.low)))) / 100;
          getRGB = Math.round((1 - opacity) * 255);
          rgb = "rgb(" + getRGB + "," + getRGB + "," + getRGB + ")";
          $(psVars.fadebar).css("opacity", opacity);
          inverseOp = 1 - opacity;
          range = psVars.h2.ml2 - psVars.h2.ml1;
          gRange = ((1 - opacity) * range) + psVars.h2.ml1;
          return _h2.css({
            "opacity": inverseOp,
            "color": rgb
          });
        } else {
          $(psVars.fadebar).css("opacity", 0);
          return _h2.css({
            "opacity": 1,
            "color": "#FFF"
          });
        }
      }
    };
    makeMinHeight = function(_this) {
      var minHeight, _section;
      minHeight = parseInt(_this.css("min-height"), 10) / em;
      _section = _this.find("section");
      return _section.css({
        "min-height": "" + (minHeight - psVars.sectionMargin.top - psVars.sectionMargin.bottom) + "em"
      });
    };
    makeItHappen = function(_this) {
      var _section;
      ResizeFu.init(_this);
      console.log("made it happen for photo_spice");
      _section = _this.find("section");
      psVars.sectionMargin = {
        top: parseInt(_section.css("margin-top"), 10) / em,
        bottom: parseInt(_section.css("margin-bottom"), 10) / em
      };
      makeMinHeight(_this);
      _this.append($("<span />").attr("id", psVars.fadebarID));
      checkScroll(_this);
      _window.scroll(function() {
        return checkScroll(_this);
      });
      return _window.resize(function() {
        return makeMinHeight(_this);
      });
    };
    exports.init = function(_this) {
      var element;
      if (_this !== void 0) {
        return makeItHappen(_this);
      } else {
        element = $("body").find("[data-module=\"" + moduleName + "\"]");
        return element.each(function() {
          return makeItHappen($(this));
        });
      }
    };
    return exports;
  });

}).call(this);
